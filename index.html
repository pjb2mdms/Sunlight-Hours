<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sunlight Angle Comparator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
    }
    header {
      background: #004c91;
      color: white;
      text-align: center;
      padding: 1rem 0;
    }
    main {
      background: white;
      max-width: 900px;
      margin: 1rem auto;
      padding: 1rem 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 { margin-top: 1.5rem; }
    label { display: block; margin-top: 0.5rem; }
    .city-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.3rem; }
    button {
      background: #004c91;
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.4rem;
      text-align: center;
    }
    th {
      background: #f0f0f0;
    }
  </style>
</head>
<body>
  <header>
    <h1>Sunlight Angle Comparator</h1>
    <p>Compare solar noon elevation, daylight duration, and equivalent dates</p>
  </header>
  <main>
    <label for="dateInput"><strong>Select Date:</strong></label>
    <input type="date" id="dateInput" value="2025-06-21">

    <h2>Select Cities:</h2>
    <div class="city-list" id="cityList"></div>

    <button onclick="compareCities()">Compare</button>

    <table id="resultsTable">
      <thead>
        <tr>
          <th>City</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Solar Noon Elevation (°)</th>
          <th>Daylight Duration (hrs)</th>
          <th>Equivalent Date (same daylight)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
    const cityData = {
      "Houston, TX": { lat: 29.7604, lon: -95.3698 },
      "St Andrews, Scotland": { lat: 56.3398, lon: -2.7967 },
      "Tampa, FL": { lat: 27.9506, lon: -82.4572 },
      "Fairbanks, AK": { lat: 64.8378, lon: -147.7164 },
      "East Longmeadow, MA": { lat: 42.0645, lon: -72.5126 },
      "Crozet, VA": { lat: 38.0696, lon: -78.7000 },
      "Hanover, NH": { lat: 43.7022, lon: -72.2896 },
      "Nashville, TN": { lat: 36.1627, lon: -86.7816 },
      "Asheville, NC": { lat: 35.5951, lon: -82.5515 }
    };

    // Populate city checkboxes
    const cityList = document.getElementById("cityList");
    Object.keys(cityData).forEach(city => {
      const label = document.createElement("label");
      label.innerHTML = `<input type="checkbox" value="${city}"> ${city}`;
      cityList.appendChild(label);
    });

    // --- Math utilities ---
    const toRad = deg => deg * Math.PI / 180;
    const toDeg = rad => rad * 180 / Math.PI;

    function dayOfYear(date) {
      const start = new Date(date.getFullYear(), 0, 0);
      const diff = date - start + (start.getTimezoneOffset() - date.getTimezoneOffset()) * 60000;
      return Math.floor(diff / 86400000);
    }

    // Solar declination angle (degrees)
    function declination(day) {
      return 23.44 * Math.sin(toRad((360 / 365) * (day - 81)));
    }

    // Solar noon elevation (degrees)
    function noonElevation(lat, dec) {
      return 90 - Math.abs(lat - dec);
    }

    // Daylight duration (hours)
    function daylightHours(lat, dec) {
      const latR = toRad(lat);
      const decR = toRad(dec);
      const cosH = -Math.tan(latR) * Math.tan(decR);
      if (cosH >= 1) return 0;
      if (cosH <= -1) return 24;
      const H = Math.acos(cosH);
      return (2 * toDeg(H)) / 15; // 15° per hour
    }

    // Find the approximate other day of year with same daylight length
    function findEquivalentDate(lat, targetHours, refDay, year) {
      for (let d = refDay + 1; d <= 365; d++) {
        const h = daylightHours(lat, declination(d));
        if (Math.abs(h - targetHours) < 0.05) {
          const eqDate = new Date(year, 0, d);
          return eqDate.toISOString().split('T')[0];
        }
      }
      return "—";
    }

    function compareCities() {
      const selected = Array.from(document.querySelectorAll("#cityList input:checked")).map(cb => cb.value);
      if (selected.length === 0) { alert("Select at least one city."); return; }

      const resultsBody = document.querySelector("#resultsTable tbody");
      resultsBody.innerHTML = "";

      const dateVal = document.getElementById("dateInput").value;
      const date = new Date(dateVal);
      const year = date.getFullYear();
      const day = dayOfYear(date);

      selected.forEach(city => {
        const { lat, lon } = cityData[city];
        const dec = declination(day);
        const elev = noonElevation(lat, dec);
        const hours = daylightHours(lat, dec);
        const eq = findEquivalentDate(lat, hours, day, year);

        const row = `<tr>
          <td>${city}</td>
          <td>${lat.toFixed(2)}</td>
          <td>${lon.toFixed(2)}</td>
          <td>${elev.toFixed(2)}</td>
          <td>${hours.toFixed(2)}</td>
          <td>${eq}</td>
        </tr>`;
        resultsBody.insertAdjacentHTML("beforeend", row);
      });
    }
  </script>
</body>
</html>
