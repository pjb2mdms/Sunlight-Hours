<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Chart.js Diagnostic Test</title>

<!-- Load Chart.js and annotation plugin -->
<script src="https://unpkg.com/chart.js@4.4.4/dist/chart.umd.js"></script>
<script src="https://unpkg.com/chartjs-plugin-annotation@3.1.1/dist/chartjs-plugin-annotation.min.js"></script>

<style>
  body { font-family: Arial, sans-serif; margin: 40px; }
  h2 { color: #0b5fb3; }
  canvas { width: 100%; max-width: 800px; height: 400px; }
</style>
</head>
<body>
  <h2>Chart.js + Annotation Plugin Diagnostic</h2>
  <canvas id="chart"></canvas>

  <script>
    // 1️⃣ Confirm both libraries loaded
    console.log("Chart.js version:", Chart.version);
    console.log("Annotation plugin:", Chart.registry.plugins.get("annotation"));

    // 2️⃣ Register plugin (some browsers need explicit registration)
    Chart.register(window["chartjs-plugin-annotation"]);

    // 3️⃣ Basic data setup
    const toRad = d => d * Math.PI / 180;
    const toDeg = r => r * 180 / Math.PI;
    const solarDeclination = d => 23.44 * Math.sin(toRad((360 / 365) * (d - 81)));
    const noonElevation = (lat, d) => 90 - Math.abs(lat - solarDeclination(d));
    const lat = 27.95; // Tampa
    const days = Array.from({ length: 365 }, (_, i) => i + 1);

    // 4️⃣ Create chart
    const ctx = document.getElementById("chart").getContext("2d");
    const chart = new Chart(ctx, {
      type: "line",
      data: {
        datasets: [{
          label: "Noon Elevation (°)",
          data: days.map(d => ({ x: d, y: noonElevation(lat, d) })),
          borderColor: "#0b5fb3",
          tension: 0.25,
          pointRadius: 0
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          annotation: {
            annotations: {
              selected: {
                type: "line",
                xMin: 80,
                xMax: 80,
                borderColor: "#000",
                borderWidth: 2,
                label: { display: true, content: "Selected", color: "#000" }
              },
              equivalent: {
                type: "line",
                xMin: 265,
                xMax: 265,
                borderColor: "#e11d48",
                borderWidth: 2,
                label: { display: true, content: "Equivalent", color: "#e11d48" }
              }
            }
          }
        },
        scales: {
          x: { type: "linear", min: 1, max: 365, title: { display: true, text: "Day of Year" } },
          y: { min: 0, max: 90, title: { display: true, text: "Noon Sun Elevation (°)" } }
        }
      }
    });
  </script>
</body>
</html>
