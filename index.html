<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sunlight Comparator</title>
<style>
  body {
    font-family: "Helvetica Neue", Arial, sans-serif;
    margin: 0;
    background: #f4f6f8;
    color: #222;
    text-align: center;
  }
  header {
    background: white;
    padding: 1rem 0.5rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  h1 { margin: 0; font-size: 1.8rem; }
  #cityDropdown, #dateSlider {
    margin: 0.5rem;
    font-size: 1rem;
    padding: 0.4rem;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 1rem;
  }
  #infoTable {
    margin-top: 1rem;
    border-collapse: collapse;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    border-radius: 8px;
    overflow: hidden;
  }
  #infoTable th, #infoTable td {
    padding: 0.6rem 1rem;
    border-bottom: 1px solid #eee;
  }
  #infoTable th { background: #fafafa; }
  #chartContainer {
    width: 90%;
    max-width: 700px;
    margin-top: 1rem;
  }
  #axialTiltContainer {
    margin-top: 1.5rem;
    width: 280px;
  }
  svg {
    width: 100%;
    height: auto;
  }
</style>
</head>
<body>
<header>
  <h1>Sunlight Comparator</h1>
  <div>
    <select id="cityDropdown">
      <option value="current">Current Location</option>
      <option value="St Andrews, Scotland">St Andrews, Scotland</option>
      <option value="Houston, TX">Houston, TX</option>
      <option value="Tampa, FL">Tampa, FL</option>
      <option value="Seattle, WA">Seattle, WA</option>
    </select>
  </div>
</header>

<main>
  <div id="dateDisplay">
    <strong>Today's Date:</strong> <span id="todayDate"></span> &nbsp; | &nbsp;
    <strong>Equivalent Date:</strong> <span id="equivalentDate"></span>
  </div>

  <input type="range" id="dateSlider" min="0" max="364" value="0" style="width:60%;">

  <table id="infoTable">
    <tr><th>Latitude</th><td id="latVal">--</td></tr>
    <tr><th>Longitude</th><td id="lonVal">--</td></tr>
    <tr><th>Solar Elevation Angle (°)</th><td id="angleVal">--</td></tr>
  </table>

  <div id="chartContainer">
    <canvas id="daylightChart"></canvas>
  </div>

  <div id="axialTiltContainer">
    <svg id="axialTiltSVG" viewBox="0 0 300 300">
      <circle cx="150" cy="150" r="70" fill="#69b3e7" stroke="#003366" stroke-width="2"/>
      <line id="axisLine" x1="150" y1="80" x2="150" y2="220"
            stroke="#222" stroke-width="3" transform="rotate(23.5,150,150)"/>
      <circle cx="150" cy="150" r="3" fill="#222"/>
      <line id="sunRays" x1="220" y1="130" x2="300" y2="130"
            stroke="#f7b500" stroke-width="4" stroke-linecap="round"/>
      <line x1="220" y1="150" x2="300" y2="150"
            stroke="#f7b500" stroke-width="4" stroke-linecap="round"/>
      <line x1="220" y1="170" x2="300" y2="170"
            stroke="#f7b500" stroke-width="4" stroke-linecap="round"/>
      <text x="140" y="280" font-size="14" fill="#555">Earth’s Tilt & Sunlight</text>
    </svg>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const today = new Date();
  const startOfYear = new Date(today.getFullYear(), 0, 1);
  const dayOfYear = Math.floor((today - startOfYear) / (1000*60*60*24));
  const dateSlider = document.getElementById("dateSlider");
  const todayDate = document.getElementById("todayDate");
  const equivalentDate = document.getElementById("equivalentDate");
  const latVal = document.getElementById("latVal");
  const lonVal = document.getElementById("lonVal");
  const angleVal = document.getElementById("angleVal");

  dateSlider.value = dayOfYear;
  todayDate.textContent = formatMMDDYYYY(today);
  equivalentDate.textContent = formatMMDDYYYY(getEquivalentDate(today));

  let chart;

  async function getCurrentCityCoords() {
    return new Promise((resolve)=>{
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          resolve({lat: pos.coords.latitude, lon: pos.coords.longitude});
        },()=>resolve({lat:0, lon:0}));
      } else resolve({lat:0, lon:0});
    });
  }

  function formatMMDDYYYY(date){
    return date.toLocaleDateString('en-US',{year:'numeric',month:'2-digit',day:'2-digit'});
  }

  function getEquivalentDate(date){
    const eq=new Date(date);
    eq.setDate(eq.getDate()+182);
    return eq;
  }

  function solarElevation(lat, day){
    const declination = 23.44 * Math.sin(((360/365)*(day-81)) * Math.PI/180);
    const elevation = 90 - Math.abs(lat - declination);
    return Math.max(0, Math.min(90, elevation));
  }

  function updateTable(lat, lon, day){
    latVal.textContent = lat.toFixed(2);
    lonVal.textContent = lon.toFixed(2);
    angleVal.textContent = solarElevation(lat, day).toFixed(1);
  }

  function updateChart(city, lat){
    const labels = Array.from({length:12}, (_,i)=>["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][i]);
    const data = Array.from({length:12}, (_,i)=>{
      const day=i*30;
      const declination = 23.44*Math.sin(((360/365)*(day-81))*Math.PI/180);
      return 12 + 4*Math.sin((lat-declination)*Math.PI/180);
    });
    if(chart) chart.destroy();
    const ctx = document.getElementById('daylightChart').getContext('2d');
    chart = new Chart(ctx, {
      type:'line',
      data:{
        labels,
        datasets:[{
          label:`Daylight Hours (${city})`,
          data,
          borderColor:'#0077cc',
          borderWidth:2,
          fill:false,
          tension:0.3
        }]
      },
      options:{
        scales:{
          x:{grid:{display:false}},
          y:{beginAtZero:true,max:24,title:{display:true,text:'Hours of Daylight'}}
        },
        plugins:{legend:{display:false}}
      }
    });
  }

  function updateAxialTilt(day){
    const svgAxis = document.getElementById("axisLine");
    const tilt = 23.5 * Math.sin(((2*Math.PI)/365)*day);
    svgAxis.setAttribute("transform", `rotate(${tilt},150,150)`);
  }

  async function initialize(){
    const coords = await getCurrentCityCoords();
    const lat = coords.lat;
    const lon = coords.lon;
    updateTable(lat, lon, dayOfYear);
    updateChart("Current Location", lat);
    updateAxialTilt(dayOfYear);
  }

  dateSlider.addEventListener("input",()=>{
    const d = parseInt(dateSlider.value);
    const current = new Date(startOfYear);
    current.setDate(d);
    todayDate.textContent = formatMMDDYYYY(current);
    equivalentDate.textContent = formatMMDDYYYY(getEquivalentDate(current));
    updateTable( latVal.textContent ? parseFloat(latVal.textContent):0,
                 lonVal.textContent ? parseFloat(lonVal.textContent):0,
                 d );
    updateAxialTilt(d);
  });

  initialize();
</script>
</body>
</html>
