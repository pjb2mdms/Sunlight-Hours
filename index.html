<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daylight Comparator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; background: #f7fafc; color: #222; }
    input, select, button { margin: 0.5rem 0; padding: 0.4rem; }
    .card { background: #fff; padding: 1rem; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1); max-width: 500px; }
    pre { white-space: pre-line; }
  </style>
</head>
<body>
  <h1>üåÖ Daylight Comparator</h1>
  <p>Compare daylight hours and solar angles for any date and find the equivalent date later in the year.</p>

  <div class="card">
    <label for="city">City:</label>
    <select id="city">
      <option value="27.9506,-82.4572">Tampa, FL</option>
      <option value="40.7128,-74.0060">New York, NY</option>
      <option value="34.0522,-118.2437">Los Angeles, CA</option>
      <option value="41.8781,-87.6298">Chicago, IL</option>
    </select><br>

    <label for="date">Date:</label>
    <input type="date" id="date" /><br>

    <button onclick="getDaylight()">Get Daylight Info</button>

    <pre id="output"></pre>
  </div>

  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
  <script>
    function getDaylight() {
      const [lat, lon] = document.getElementById('city').value.split(',').map(Number);
      const date = new Date(document.getElementById('date').value);
      if (isNaN(date)) return alert("Please select a valid date.");

      const daylightHrs = getDaylightHours(date, lat, lon);
      const solarNoon = getSolarElevation(date, lat, lon);

      const equivalent = findEquivalentDate(date, lat, lon);
      const eqDaylight = getDaylightHours(equivalent, lat, lon);

      document.getElementById('output').textContent =
        `üìç Location: ${document.getElementById('city').selectedOptions[0].text}\n` +
        `üìÖ Selected Date: ${date.toDateString()}\n` +
        `   ‚Ä¢ Daylight: ${daylightHrs.toFixed(2)} hours\n` +
        `   ‚Ä¢ Solar Elevation (noon): ${solarNoon.toFixed(1)}¬∞\n\n` +
        `üîÅ Equivalent Date: ${equivalent.toDateString()}\n` +
        `   ‚Ä¢ Daylight: ${eqDaylight.toFixed(2)} hours`;
    }

    function getDaylightHours(date, lat, lon) {
      const times = SunCalc.getTimes(date, lat, lon);
      return (times.sunset - times.sunrise) / 1000 / 3600;
    }

    function getSolarElevation(date, lat, lon) {
      const times = SunCalc.getTimes(date, lat, lon);
      const pos = SunCalc.getPosition(times.solarNoon, lat, lon);
      return pos.altitude * (180 / Math.PI);
    }

    function findEquivalentDate(date, lat, lon) {
      const base = getDaylightHours(date, lat, lon);
      const year = date.getFullYear();
      const targetDate = new Date(date);
      const start = new Date(year, 0, 1);
      const end = new Date(year, 11, 31);

      // Search forward in the year for a matching daylight length within 0.05h (3 min)
      for (let d = new Date(date); d <= end; d.setDate(d.getDate() + 1)) {
        const diff = Math.abs(getDaylightHours(d, lat, lon) - base);
        if (diff < 0.05 && d - date > 30 * 24 * 3600 * 1000) {
          return new Date(d);
        }
      }
      // Otherwise, look backward
      for (let d = new Date(date); d >= start; d.setDate(d.getDate() - 1)) {
        const diff = Math.abs(getDaylightHours(d, lat, lon) - base);
        if (diff < 0.05 && date - d > 30 * 24 * 3600 * 1000) {
          return new Date(d);
        }
      }
      // Fallback if not found
      return new Date(year, (date.getMonth() + 6) % 12, date.getDate());
    }
  </script>
</body>
</html>
