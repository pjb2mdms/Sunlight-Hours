<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sunlight Comparator</title>
<style>
  body {
    font-family: "Helvetica Neue", Arial, sans-serif;
    background: #f7f9fb;
    color: #222;
    text-align: center;
    margin: 0;
    padding: 0;
  }

  header {
    padding: 1rem 0.5rem;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  h1 {
    font-size: 1.8rem;
    margin: 0.2rem 0;
  }

  #dateDisplay {
    margin-top: 0.5rem;
    font-size: 1rem;
  }

  #dateDisplay span {
    font-weight: 500;
  }

  #sliderContainer {
    margin: 1.2rem auto;
    width: 80%;
    max-width: 600px;
  }

  #dateSlider {
    width: 100%;
  }

  #chartContainer {
    width: 90%;
    max-width: 700px;
    margin: 0 auto;
  }

  canvas {
    width: 100%;
    height: 400px;
  }

  table {
    margin: 1.5rem auto;
    border-collapse: collapse;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    border-radius: 8px;
    overflow: hidden;
  }

  th, td {
    padding: 0.6rem 1rem;
    border-bottom: 1px solid #eee;
  }

  th {
    background: #fafafa;
    font-weight: 600;
  }

  #arcVisual {
    width: 180px;
    height: 90px;
    margin: 0.5rem auto 1.5rem auto;
  }

  #arcVisual svg {
    width: 100%;
    height: 100%;
  }
</style>
</head>
<body>
<header>
  <h1>Sunlight Comparator</h1>
  <div id="dateDisplay">
    <strong>Selected Date:</strong> <span id="selectedDate"></span> &nbsp; | &nbsp;
    <strong>Equivalent Date:</strong> <span id="equivalentDate"></span>
  </div>
</header>

<main>
  <div id="sliderContainer">
    <input type="range" id="dateSlider" min="0" max="364" value="0">
  </div>

  <div id="chartContainer">
    <canvas id="daylightChart"></canvas>
  </div>

  <div id="arcVisual">
    <svg viewBox="0 0 200 100">
      <path d="M10,90 A90,90 0 0,1 190,90" fill="none" stroke="#0077cc" stroke-width="3" />
      <circle id="sunMarker" cx="100" cy="90" r="5" fill="#f7b500"/>
    </svg>
  </div>

  <table>
    <tr><th>Latitude</th><td id="latVal">--</td></tr>
    <tr><th>Longitude</th><td id="lonVal">--</td></tr>
    <tr><th>Solar Elevation Angle (Â°)</th><td id="angleVal">--</td></tr>
  </table>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // ---- Utility functions ----
  const today = new Date();
  const startOfYear = new Date(today.getFullYear(), 0, 1);
  const dayOfYear = Math.floor((today - startOfYear) / (1000*60*60*24));

  function formatDate(d) {
    return d.toLocaleDateString('en-US', { year:'numeric', month:'2-digit', day:'2-digit' });
  }

  function getEquivalentDate(date) {
    const eq = new Date(date);
    eq.setDate(eq.getDate() + 182);
    if (eq.getFullYear() > date.getFullYear()) eq.setFullYear(date.getFullYear());
    return eq;
  }

  // Solar declination approximation
  function declination(day) {
    return 23.44 * Math.sin(((360/365)*(day-81)) * Math.PI/180);
  }

  function daylightHours(lat, day) {
    const radLat = lat * Math.PI / 180;
    const radDec = declination(day) * Math.PI / 180;
    const cosH = -Math.tan(radLat) * Math.tan(radDec);
    const H = Math.acos(Math.min(Math.max(cosH, -1), 1));
    return (2 * H * 180/Math.PI) / 15; // convert radians to hours
  }

  function solarElevation(lat, day) {
    const dec = declination(day);
    return 90 - Math.abs(lat - dec);
  }

  // ---- Chart + UI ----
  const slider = document.getElementById("dateSlider");
  const selectedDateEl = document.getElementById("selectedDate");
  const equivalentDateEl = document.getElementById("equivalentDate");
  const latVal = document.getElementById("latVal");
  const lonVal = document.getElementById("lonVal");
  const angleVal = document.getElementById("angleVal");
  const sunMarker = document.getElementById("sunMarker");

  const lat = 27.95; // default (Tampa)
  const lon = -82.46;

  let chart;

  function updateChart(day) {
    const days = Array.from({length:365}, (_,i)=>i);
    const hours = days.map(d => daylightHours(lat, d));
    const ctx = document.getElementById('daylightChart').getContext('2d');

    if (chart) chart.destroy();

    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: days,
        datasets: [{
          label: 'Daylight Hours',
          data: hours,
          borderColor: '#0077cc',
          borderWidth: 2,
          fill: false,
          tension: 0.3
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: {
            grid: { display: false },
            title: { display: false },
            ticks: { display: false }
          },
          y: {
            title: { display: true, text: 'Hours of Daylight' },
            min: 0, max: 24
          }
        },
        animation: false
      }
    });

    addVerticalLines(day, (day+182)%365);
  }

  function addVerticalLines(selectedDay, eqDay) {
    const chartArea = chart.chartArea;
    const ctx = chart.ctx;
    const xScale = chart.scales.x;
    chart.update();

    // draw after render
    chart.options.animation = false;
    chart.render();
    const x1 = xScale.getPixelForValue(selectedDay);
    const x2 = xScale.getPixelForValue(eqDay);
    const yTop = chart.scales.y.top;
    const yBottom = chart.scales.y.bottom;

    ctx.save();
    ctx.beginPath();
    ctx.moveTo(x1, yTop);
    ctx.lineTo(x1, yBottom);
    ctx.strokeStyle = "#f7b500";
    ctx.lineWidth = 2;
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(x2, yTop);
    ctx.lineTo(x2, yBottom);
    ctx.strokeStyle = "#0077cc";
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.restore();
  }

  function updateDisplay(day) {
    const current = new Date(startOfYear);
    current.setDate(day);
    const eq = getEquivalentDate(current);

    selectedDateEl.textContent = formatDate(current);
    equivalentDateEl.textContent = formatDate(eq);

    latVal.textContent = lat.toFixed(2);
    lonVal.textContent = lon.toFixed(2);
    const elev = solarElevation(lat, day);
    angleVal.textContent = elev.toFixed(1);

    // Move sun marker along arc
    const angleRad = Math.PI * (1 - elev/90);
    const x = 100 + 80 * Math.cos(angleRad);
    const y = 90 - 80 * Math.sin(angleRad);
    sunMarker.setAttribute("cx", x);
    sunMarker.setAttribute("cy", y);
  }

  // ---- Initialize ----
  slider.value = dayOfYear;
  updateChart(dayOfYear);
  updateDisplay(dayOfYear);

  slider.addEventListener("input", () => {
    const d = parseInt(slider.value);
    updateChart(d);
    updateDisplay(d);
  });
</script>
</body>
</html>
