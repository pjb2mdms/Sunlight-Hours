<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daylight Visualization Comparison Demo</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff;
    color: #000;
    margin: 0;
    padding: 1rem 2rem;
  }
  h2 {
    margin-top: 3rem;
    border-top: 1px solid #ccc;
    padding-top: 1rem;
  }
  canvas {
    width: 100% !important;
    max-width: 900px;
    height: 400px !important;
    display: block;
    margin: 1rem auto;
  }
  .chart-container {
    text-align: center;
    margin-bottom: 2rem;
  }
  svg {
    display: block;
    margin: 0 auto;
  }
</style>
</head>
<body>
<h1>Daylight Visualization Comparison Demo</h1>
<p>Two sample cities: Tampa, FL and St Andrews, Scotland</p>

<!-- Option A -->
<h2>Option A — Enhanced Line Graph</h2>
<div class="chart-container">
  <canvas id="chartA"></canvas>
</div>

<!-- Option B -->
<h2>Option B — Seasonal Arc Layout</h2>
<div class="chart-container">
  <svg id="arcChart" width="900" height="300"></svg>
</div>

<!-- Option C -->
<h2>Option C — Sunrise–Sunset Band Chart</h2>
<div class="chart-container">
  <canvas id="chartC"></canvas>
</div>

<!-- Option D -->
<h2>Option D — Gradient Year Strip</h2>
<div class="chart-container">
  <canvas id="chartD" height="120"></canvas>
</div>

<script>
/* ---------- Optimized daylight calculation ---------- */
const toRad = d => d * Math.PI / 180;

function solarDeclination(day) {
  return 23.44 * Math.sin(toRad((360 / 365) * (day - 81)));
}
function daylightHours(lat, day) {
  const decl = toRad(solarDeclination(day));
  const latR = toRad(lat);
  const cosH = -Math.tan(latR) * Math.tan(decl);
  if (cosH >= 1) return 0;
  if (cosH <= -1) return 24;
  const H = Math.acos(cosH);
  return (2 * H * 180 / Math.PI) / 15;
}

/* ---------- Generate data ---------- */
const cities = [
  { name: "Tampa, FL", lat: 27.95, color: "#f28e2b" },
  { name: "St Andrews, Scotland", lat: 56.34, color: "#4e79a7" }
];
const days = Array.from({length: 365}, (_, i) => i + 1);
const months = [1,32,60,91,121,152,182,213,244,274,305,335];
const monthLabels = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

/* ---------- Option A: Enhanced Line Graph ---------- */
{
  const ctx = document.getElementById('chartA').getContext('2d');
  const datasets = cities.map(c => ({
    label: c.name,
    data: days.map(d => daylightHours(c.lat, d)),
    borderColor: c.color,
    fill: false,
    tension: 0.2
  }));

  new Chart(ctx, {
    type: 'line',
    data: { labels: days, datasets },
    options: {
      plugins: { legend: { position: 'bottom' } },
      scales: {
        x: {
          title: { display: true, text: "Month" },
          ticks: {
            callback: function(value, index) {
              const day = days[index];
              const labelIndex = months.findIndex(m => day < m);
              return labelIndex >= 0 ? monthLabels[labelIndex-1] : "";
            },
            maxRotation: 0,
            autoSkip: true
          }
        },
        y: {
          title: { display: true, text: "Daylight Hours" },
          min: 5, max: 20
        }
      }
    }
  });
}

/* ---------- Option B: Seasonal Arc Layout ---------- */
{
  const svg = document.getElementById("arcChart");
  const width = svg.getAttribute("width");
  const height = svg.getAttribute("height");
  const cx = width / 2;
  const cy = height - 40;
  const radiusBase = 80;

  cities.forEach((c, idx) => {
    const radius = radiusBase + idx * 60;
    const path = document.createElementNS("http://www.w3.org/2000/svg","path");
    let dAttr = "";
    for (let i=0; i<=180; i+=2) {
      const day = Math.round((i/180)*365);
      const hrs = daylightHours(c.lat, day);
      const y = cy - (hrs - 6) * 5;
      const x = cx - radius * Math.cos(toRad(i));
      dAttr += (i===0 ? "M":"L") + x + "," + y + " ";
    }
    path.setAttribute("d", dAttr);
    path.setAttribute("stroke", c.color);
    path.setAttribute("fill", "none");
    path.setAttribute("stroke-width", 3);
    svg.appendChild(path);
    const text = document.createElementNS("http://www.w3.org/2000/svg","text");
    text.textContent = c.name;
    text.setAttribute("x", 20);
    text.setAttribute("y", 40 + idx*60);
    text.setAttribute("fill", c.color);
    text.setAttribute("font-size", "14");
    svg.appendChild(text);
  });
}

/* ---------- Option C: Sunrise–Sunset Band Chart ---------- */
{
  function sunriseSunset(lat, day) {
    const dec = toRad(solarDeclination(day));
    const latR = toRad(lat);
    const cosH = -Math.tan(latR)*Math.tan(dec);
    if (cosH >= 1) return { rise: NaN, set: NaN };
    if (cosH <= -1) return { rise: 0, set: 24 };
    const H = Math.acos(cosH) * 180 / Math.PI;
    return { rise: 12 - H/15, set: 12 + H/15 };
  }

  const ctx = document.getElementById('chartC').getContext('2d');
  const datasets = cities.flatMap(c => {
    const rise = days.map(d => sunriseSunset(c.lat,d).rise);
    const set = days.map(d => sunriseSunset(c.lat,d).set);
    return [
      { label: c.name + " Sunset", data: set, borderColor: c.color, fill: false, tension: 0.1 },
      { label: c.name + " Sunrise", data: rise, borderColor: c.color, borderDash: [4,3], fill: false, tension: 0.1 }
    ];
  });

  new Chart(ctx, {
    type: 'line',
    data: { labels: days, datasets },
    options: {
      plugins: { legend: { position: 'bottom' } },
      scales: {
        x: {
          title: { display: true, text: "Month" },
          ticks: {
            callback: function(value, index) {
              const day = days[index];
              const labelIndex = months.findIndex(m => day < m);
              return labelIndex >= 0 ? monthLabels[labelIndex-1] : "";
            },
            maxRotation: 0,
            autoSkip: true
          }
        },
        y: {
          title: { display: true, text: "Hour of Day" },
          min: 0, max: 24
        }
      }
    }
  });
}

/* ---------- Option D: Gradient Year Strip ---------- */
{
  const ctx = document.getElementById("chartD").getContext("2d");
  const imgData = ctx.createImageData(365, 2 * cities.length);
  cities.forEach((c, idx) => {
    for (let d = 0; d < 365; d++) {
      const hrs = daylightHours(c.lat, d+1);
      const val = Math.round((hrs - 5) / 15 * 255);
      for (let y = 0; y < 2; y++) {
        const base = 4 * ((idx*2 + y)*365 + d);
        imgData.data[base] = 255 - val/2; // red
        imgData.data[base+1] = 180 - val/3; // green
        imgData.data[base+2] = val; // blue intensity
        imgData.data[base+3] = 255;
      }
    }
  });
  ctx.putImageData(imgData, 0, 0);
  ctx.font = "14px Arial";
  cities.forEach((c, idx) => {
    ctx.fillStyle = "#000";
    ctx.fillText(c.name, 5, (idx*2+1)*20);
  });
  ctx.strokeStyle = "#000";
  months.forEach(m => {
    const x = m * (ctx.canvas.width/365);
    ctx.beginPath();
    ctx.moveTo(x,0);
    ctx.lineTo(x,ctx.canvas.height);
    ctx.stroke();
  });
}
</script>
</body>
</html>
